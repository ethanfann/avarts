!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).toGeoJSON={})}(this,(function(e){"use strict";function t(e){return e&&e.normalize&&e.normalize(),e&&e.textContent||""}const n=[["speed","speeds"],["course","courses"],["hAcc","hAccs"],["vAcc","vAccs"],["heartRate","heartRates"]];function o(e){const n={};if(e){const o=l(e,"line");if(o){const e=t(l(o,"color")),r=parseFloat(t(l(o,"opacity"))),s=parseFloat(t(l(o,"width")));e&&(n.stroke=e),isNaN(r)||(n["stroke-opacity"]=r),isNaN(s)||(n["stroke-width"]=96*s/25.4)}}return n}function r(e,n){const o={};let r,s;for(s=0;s<n.length;s++)r=l(e,n[s]),r&&(o[n[s]]=t(r));return o}function s(e){const n=r(e,["name","cmt","desc","type","time","keywords"]),o=e.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*");for(let r=0;r<o.length;r++){const s=o[r];s.parentNode.parentNode===e&&(n[s.tagName.replace(":","_")]=t(s))}const s=e.getElementsByTagName("link");s.length&&(n.links=[]);for(let e=0;e<s.length;e++)n.links.push(Object.assign({href:s[e].getAttribute("href")},r(s[e],["text","type"])));return n}function l(e,t){const n=e.getElementsByTagName(t);return n.length?n[0]:null}function i(e){const o=[parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))],r=l(e,"ele"),s=l(e,"gpxtpx:hr")||l(e,"hr"),i=l(e,"time");let a;r&&(a=parseFloat(t(r)),isNaN(a)||o.push(a));const c={coordinates:o,time:i?t(i):null,heartRate:s?parseFloat(t(s)):null},g=l(e,"extensions");return null!==g&&n.map(e=>e[0]).filter(e=>"heartrate"!==e).forEach(e=>{const n=l(g,e);if(null!==n){const o=parseFloat(t(n));isNaN(o)||(c[e]=o)}}),c}function a(e){const t=c(e,"rtept");if(t.line)return{type:"Feature",properties:Object.assign(s(e),o(l(e,"extensions"))),geometry:{type:"LineString",coordinates:t.line}}}function c(e,t){const o=e.getElementsByTagName(t),r=[],s=[],l=o.length,a={};if(l<2)return{};for(let e=0;e<l;e++){const t=i(o[e]);r.push(t.coordinates),t.time&&s.push(t.time),n.map(e=>e[0]).forEach(n=>{(t[n]||a[n])&&(a[n]||(a[n]=Array(e).fill(null)),a[n].push(t[n]||null))})}const c={line:r,times:s};return n.forEach(e=>{a[e[0]]&&(c[e[1]]=a[e[0]]||[])}),c}function g(e){const t=e.getElementsByTagName("trkseg"),r=[],i=[],a={};let g;for(let e=0;e<t.length;e++)g=c(t[e],"trkpt"),g&&(g.line&&r.push(g.line),g.times&&g.times.length&&i.push(g.times),n.map(e=>e[1]).forEach(t=>{if(a[t]&&a[t].length||g[t]&&g[t].length){if(a[t]||(a[t]=[]),!a[t].length)for(let n=0;n<e;n++)a[t].push(Array(r[n].length).fill(null));g[t]&&g[t].length?a[t].push(g[t]):a[t].push(Array(g.line.length||0).fill(null))}}));if(0===r.length)return;const u=Object.assign(s(e),o(l(e,"extensions")));return i.length&&(u.coordTimes=1===r.length?i[0]:i),n.forEach(e=>{a[e[1]]&&a[e[1]].length&&(u[e[1]]=1===r.length?a[e[1]][0]:a[e[1]])}),{type:"Feature",properties:u,geometry:{type:1===r.length?"LineString":"MultiLineString",coordinates:1===r.length?r[0]:r}}}function*u(e){const t=e.getElementsByTagName("trk"),n=e.getElementsByTagName("rte"),o=e.getElementsByTagName("wpt");for(let e=0;e<t.length;e++){const n=g(t[e]);n&&(yield n)}for(let e=0;e<n.length;e++){const t=a(n[e]);t&&(yield t)}for(let e=0;e<o.length;e++)yield(l=o[e],{type:"Feature",properties:Object.assign(s(l),r(l,["sym"])),geometry:{type:"Point",coordinates:i(l).coordinates}});var l}const m=/\s*/g,f=/^\s*|\s*$/g,p=/\s+/;function h(e){if(!e||!e.length)return 0;let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t}function y(e,t){const n=e.getElementsByTagName(t);return n.length?n[0]:null}function d(e){return e.replace(m,"").split(",").map(parseFloat)}function N(e){return e.replace(f,"").split(p).map(d)}function T(e){if(void 0!==e.xml)return e.xml;if(e.tagName){let t=e.tagName;for(let n=0;n<e.attributes.length;n++)t+=e.attributes[n].name+e.attributes[n].value;for(let n=0;n<e.childNodes.length;n++)t+=T(e.childNodes[n]);return t}return"#text"===e.nodeName?(e.nodeValue||e.value||"").trim():"#cdata-section"===e.nodeName?e.nodeValue:""}const b=["Polygon","LineString","Point","Track","gx:Track"];function k(e,n,o){let r=t(y(n,"color"))||"";const s="stroke"==o||"fill"===o?o:o+"-color";"#"===r.substr(0,1)&&(r=r.substr(1)),6===r.length||3===r.length?e[s]=r:8===r.length&&(e[o+"-opacity"]=parseInt(r.substr(0,2),16)/255,e[s]="#"+r.substr(6,2)+r.substr(4,2)+r.substr(2,2))}function E(e,n,o,r){const s=parseFloat(t(y(n,o)));isNaN(s)||(e[r]=s)}function x(e){let n=e.getElementsByTagName("coord");const o=[],r=[];0===n.length&&(n=e.getElementsByTagName("gx:coord"));for(let e=0;e<n.length;e++)o.push(t(n[e]).split(" ").map(parseFloat));const s=e.getElementsByTagName("when");for(let e=0;e<s.length;e++)r.push(t(s[e]));return{coords:o,times:r}}function S(e,n,o,r){const s=function e(n){let o,r,s,l,i;const a=[],c=[];if(y(n,"MultiGeometry"))return e(y(n,"MultiGeometry"));if(y(n,"MultiTrack"))return e(y(n,"MultiTrack"));if(y(n,"gx:MultiTrack"))return e(y(n,"gx:MultiTrack"));for(s=0;s<b.length;s++)if(r=n.getElementsByTagName(b[s]),r)for(l=0;l<r.length;l++)if(o=r[l],"Point"===b[s])a.push({type:"Point",coordinates:d(t(y(o,"coordinates")))});else if("LineString"===b[s])a.push({type:"LineString",coordinates:N(t(y(o,"coordinates")))});else if("Polygon"===b[s]){const e=o.getElementsByTagName("LinearRing"),n=[];for(i=0;i<e.length;i++)n.push(N(t(y(e[i],"coordinates"))));a.push({type:"Polygon",coordinates:n})}else if("Track"===b[s]||"gx:Track"===b[s]){const e=x(o);a.push({type:"LineString",coordinates:e.coords}),e.times.length&&c.push(e.times)}return{geoms:a,coordTimes:c}}(e);let l;const i={},a=t(y(e,"name")),c=t(y(e,"address"));let g=t(y(e,"styleUrl"));const u=t(y(e,"description")),m=y(e,"TimeSpan"),f=y(e,"TimeStamp"),p=y(e,"ExtendedData");let h=y(e,"IconStyle"),T=y(e,"LabelStyle"),S=y(e,"LineStyle"),A=y(e,"PolyStyle");const B=y(e,"visibility");if(a&&(i.name=a),c&&(i.address=c),g){"#"!==g[0]&&(g="#"+g),i.styleUrl=g,n[g]&&(i.styleHash=n[g]),o[g]&&(i.styleMapHash=o[g],i.styleHash=n[o[g].normal]);const e=r[i.styleHash];e&&(h||(h=y(e,"IconStyle")),T||(T=y(e,"LabelStyle")),S||(S=y(e,"LineStyle")),A||(A=y(e,"PolyStyle")))}if(u&&(i.description=u),m){const e=t(y(m,"begin")),n=t(y(m,"end"));i.timespan={begin:e,end:n}}if(f&&(i.timestamp=t(y(f,"when"))),h){k(i,h,"icon"),E(i,h,"scale","icon-scale"),E(i,h,"heading","icon-heading");const e=y(h,"hotSpot");if(e){const t=parseFloat(e.getAttribute("x")),n=parseFloat(e.getAttribute("y"));isNaN(t)||isNaN(n)||(i["icon-offset"]=[t,n])}const n=y(h,"Icon");if(n){const e=t(y(n,"href"));e&&(i.icon=e)}}if(T&&(k(i,T,"label"),E(i,T,"scale","label-scale")),S&&(k(i,S,"stroke"),E(i,S,"width","stroke-width")),A){k(i,A,"fill");const e=t(y(A,"fill")),n=t(y(A,"outline"));e&&(i["fill-opacity"]="1"===e?i["fill-opacity"]||1:0),n&&(i["stroke-opacity"]="1"===n?i["stroke-opacity"]||1:0)}if(p){const e=p.getElementsByTagName("Data"),n=p.getElementsByTagName("SimpleData");for(l=0;l<e.length;l++)i[e[l].getAttribute("name")]=t(y(e[l],"value"));for(l=0;l<n.length;l++)i[n[l].getAttribute("name")]=t(n[l])}B&&(i.visibility=t(B)),s.coordTimes.length&&(i.coordTimes=1===s.coordTimes.length?s.coordTimes[0]:s.coordTimes);const F={type:"Feature",geometry:0===s.geoms.length?null:1===s.geoms.length?s.geoms[0]:{type:"GeometryCollection",geometries:s.geoms},properties:i};return e.getAttribute("id")&&(F.id=e.getAttribute("id")),F}function*A(e){const n={},o={},r={},s=e.getElementsByTagName("Placemark"),l=e.getElementsByTagName("Style"),i=e.getElementsByTagName("StyleMap");for(let e=0;e<l.length;e++){const t=h(T(l[e])).toString(16);n["#"+l[e].getAttribute("id")]=t,o[t]=l[e]}for(let e=0;e<i.length;e++){n["#"+i[e].getAttribute("id")]=h(T(i[e])).toString(16);const o=i[e].getElementsByTagName("Pair"),s={};for(let e=0;e<o.length;e++)s[t(y(o[e],"key"))]=t(y(o[e],"styleUrl"));r["#"+i[e].getAttribute("id")]=s}for(let e=0;e<s.length;e++){const t=S(s[e],n,r,o);t&&(yield t)}}e.gpx=function(e){return{type:"FeatureCollection",features:Array.from(u(e))}},e.gpxGen=u,e.kml=function(e){return{type:"FeatureCollection",features:Array.from(A(e))}},e.kmlGen=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=togeojson.umd.js.map
