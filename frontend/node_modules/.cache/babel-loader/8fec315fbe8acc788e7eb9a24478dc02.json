{"ast":null,"code":"import { Slot } from \"@wry/context\";\nimport { dep } from \"optimism\";\nvar varDep = dep();\nexport var cacheSlot = new Slot();\nexport function makeVar(value) {\n  var caches = new Set();\n  return function rv(newValue) {\n    if (arguments.length > 0) {\n      if (value !== newValue) {\n        value = newValue;\n        varDep.dirty(rv);\n        caches.forEach(broadcast);\n      }\n    } else {\n      var cache = cacheSlot.getValue();\n      if (cache) caches.add(cache);\n      varDep(rv);\n    }\n\n    return value;\n  };\n}\n\nfunction broadcast(cache) {\n  if (cache.broadcastWatches) {\n    cache.broadcastWatches();\n  }\n}","map":{"version":3,"sources":["../../../src/cache/inmemory/reactiveVars.ts"],"names":[],"mappings":"AAAA,SAAS,IAAT,QAAqB,cAArB;AACA,SAAS,GAAT,QAAoB,UAApB;AAMA,IAAM,MAAM,GAAG,GAAG,EAAlB;AAIA,OAAO,IAAM,SAAS,GAAG,IAAI,IAAJ,EAAlB;AAEP,OAAM,SAAU,OAAV,CAAqB,KAArB,EAA6B;AACjC,MAAM,MAAM,GAAG,IAAI,GAAJ,EAAf;AAEA,SAAO,SAAS,EAAT,CAAY,QAAZ,EAAoB;AACzB,QAAI,SAAS,CAAC,MAAV,GAAmB,CAAvB,EAA0B;AACxB,UAAI,KAAK,KAAK,QAAd,EAAwB;AACtB,QAAA,KAAK,GAAG,QAAR;AACA,QAAA,MAAM,CAAC,KAAP,CAAa,EAAb;AAGA,QAAA,MAAM,CAAC,OAAP,CAAe,SAAf;AACD;AACF,KARD,MAQO;AAIL,UAAM,KAAK,GAAG,SAAS,CAAC,QAAV,EAAd;AACA,UAAI,KAAJ,EAAW,MAAM,CAAC,GAAP,CAAW,KAAX;AACX,MAAA,MAAM,CAAC,EAAD,CAAN;AACD;;AAED,WAAO,KAAP;AACD,GAnBD;AAoBD;;AAQD,SAAS,SAAT,CAAmB,KAAnB,EAAuC;AACrC,MAAI,KAAK,CAAC,gBAAV,EAA4B;AAC1B,IAAA,KAAK,CAAC,gBAAN;AACD;AACF","sourceRoot":"","sourcesContent":["import { Slot } from \"@wry/context\";\nimport { dep } from \"optimism\";\nvar varDep = dep();\nexport var cacheSlot = new Slot();\nexport function makeVar(value) {\n    var caches = new Set();\n    return function rv(newValue) {\n        if (arguments.length > 0) {\n            if (value !== newValue) {\n                value = newValue;\n                varDep.dirty(rv);\n                caches.forEach(broadcast);\n            }\n        }\n        else {\n            var cache = cacheSlot.getValue();\n            if (cache)\n                caches.add(cache);\n            varDep(rv);\n        }\n        return value;\n    };\n}\nfunction broadcast(cache) {\n    if (cache.broadcastWatches) {\n        cache.broadcastWatches();\n    }\n}\n//# sourceMappingURL=reactiveVars.js.map"]},"metadata":{},"sourceType":"module"}