{"ast":null,"code":"import { __assign, __extends, __rest } from \"tslib\";\nimport React from 'react';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport { parser } from \"../parser/index.js\";\nimport { Subscription } from \"../components/index.js\";\nimport { getDisplayName, GraphQLBase, calculateVariablesFromProps, defaultMapPropsToOptions, defaultMapPropsToSkip } from \"./hoc-utils.js\";\nexport function withSubscription(document, operationOptions) {\n  if (operationOptions === void 0) {\n    operationOptions = {};\n  }\n\n  var operation = parser(document);\n  var _a = operationOptions.options,\n      options = _a === void 0 ? defaultMapPropsToOptions : _a,\n      _b = operationOptions.skip,\n      skip = _b === void 0 ? defaultMapPropsToSkip : _b,\n      _c = operationOptions.alias,\n      alias = _c === void 0 ? 'Apollo' : _c,\n      shouldResubscribe = operationOptions.shouldResubscribe;\n  var mapPropsToOptions = options;\n  if (typeof mapPropsToOptions !== 'function') mapPropsToOptions = function () {\n    return options;\n  };\n  var mapPropsToSkip = skip;\n  if (typeof mapPropsToSkip !== 'function') mapPropsToSkip = function () {\n    return skip;\n  };\n  var lastResultProps;\n  return function (WrappedComponent) {\n    var graphQLDisplayName = alias + \"(\" + getDisplayName(WrappedComponent) + \")\";\n\n    var GraphQL = function (_super) {\n      __extends(GraphQL, _super);\n\n      function GraphQL(props) {\n        var _this = _super.call(this, props) || this;\n\n        _this.state = {\n          resubscribe: false\n        };\n        return _this;\n      }\n\n      GraphQL.prototype.componentDidUpate = function (prevProps) {\n        if (shouldResubscribe) {\n          this.setState({\n            resubscribe: shouldResubscribe(prevProps, this.props)\n          });\n        }\n      };\n\n      GraphQL.prototype.render = function () {\n        var _this = this;\n\n        var props = this.props;\n        var shouldSkip = mapPropsToSkip(props);\n        var opts = shouldSkip ? Object.create(null) : mapPropsToOptions(props);\n\n        if (!shouldSkip && !opts.variables && operation.variables.length > 0) {\n          opts.variables = calculateVariablesFromProps(operation, props);\n        }\n\n        return React.createElement(Subscription, __assign({}, opts, {\n          displayName: graphQLDisplayName,\n          skip: shouldSkip,\n          subscription: document,\n          shouldResubscribe: this.state.resubscribe\n        }), function (_a) {\n          var _b, _c;\n\n          var data = _a.data,\n              r = __rest(_a, [\"data\"]);\n\n          if (operationOptions.withRef) {\n            _this.withRef = true;\n            props = Object.assign({}, props, {\n              ref: _this.setWrappedInstance\n            });\n          }\n\n          if (shouldSkip) {\n            return React.createElement(WrappedComponent, __assign({}, props, {}));\n          }\n\n          var result = Object.assign(r, data || {});\n          var name = operationOptions.name || 'data';\n          var childProps = (_b = {}, _b[name] = result, _b);\n\n          if (operationOptions.props) {\n            var newResult = (_c = {}, _c[name] = result, _c.ownProps = props, _c);\n            lastResultProps = operationOptions.props(newResult, lastResultProps);\n            childProps = lastResultProps;\n          }\n\n          return React.createElement(WrappedComponent, __assign({}, props, childProps));\n        });\n      };\n\n      GraphQL.displayName = graphQLDisplayName;\n      GraphQL.WrappedComponent = WrappedComponent;\n      return GraphQL;\n    }(GraphQLBase);\n\n    return hoistNonReactStatics(GraphQL, WrappedComponent, {});\n  };\n}","map":{"version":3,"sources":["../../../src/react/hoc/subscription-hoc.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __extends, __rest } from \"tslib\";\nimport React from 'react';\nimport hoistNonReactStatics from 'hoist-non-react-statics';\nimport { parser } from \"../parser/index.js\";\nimport { Subscription } from \"../components/index.js\";\nimport { getDisplayName, GraphQLBase, calculateVariablesFromProps, defaultMapPropsToOptions, defaultMapPropsToSkip } from \"./hoc-utils.js\";\nexport function withSubscription(document, operationOptions) {\n    if (operationOptions === void 0) { operationOptions = {}; }\n    var operation = parser(document);\n    var _a = operationOptions.options, options = _a === void 0 ? defaultMapPropsToOptions : _a, _b = operationOptions.skip, skip = _b === void 0 ? defaultMapPropsToSkip : _b, _c = operationOptions.alias, alias = _c === void 0 ? 'Apollo' : _c, shouldResubscribe = operationOptions.shouldResubscribe;\n    var mapPropsToOptions = options;\n    if (typeof mapPropsToOptions !== 'function')\n        mapPropsToOptions = function () { return options; };\n    var mapPropsToSkip = skip;\n    if (typeof mapPropsToSkip !== 'function')\n        mapPropsToSkip = function () { return skip; };\n    var lastResultProps;\n    return function (WrappedComponent) {\n        var graphQLDisplayName = alias + \"(\" + getDisplayName(WrappedComponent) + \")\";\n        var GraphQL = (function (_super) {\n            __extends(GraphQL, _super);\n            function GraphQL(props) {\n                var _this = _super.call(this, props) || this;\n                _this.state = { resubscribe: false };\n                return _this;\n            }\n            GraphQL.prototype.componentDidUpate = function (prevProps) {\n                if (shouldResubscribe) {\n                    this.setState({\n                        resubscribe: shouldResubscribe(prevProps, this.props)\n                    });\n                }\n            };\n            GraphQL.prototype.render = function () {\n                var _this = this;\n                var props = this.props;\n                var shouldSkip = mapPropsToSkip(props);\n                var opts = shouldSkip\n                    ? Object.create(null)\n                    : mapPropsToOptions(props);\n                if (!shouldSkip && !opts.variables && operation.variables.length > 0) {\n                    opts.variables = calculateVariablesFromProps(operation, props);\n                }\n                return (React.createElement(Subscription, __assign({}, opts, { displayName: graphQLDisplayName, skip: shouldSkip, subscription: document, shouldResubscribe: this.state.resubscribe }), function (_a) {\n                    var _b, _c;\n                    var data = _a.data, r = __rest(_a, [\"data\"]);\n                    if (operationOptions.withRef) {\n                        _this.withRef = true;\n                        props = Object.assign({}, props, {\n                            ref: _this.setWrappedInstance\n                        });\n                    }\n                    if (shouldSkip) {\n                        return (React.createElement(WrappedComponent, __assign({}, props, {})));\n                    }\n                    var result = Object.assign(r, data || {});\n                    var name = operationOptions.name || 'data';\n                    var childProps = (_b = {}, _b[name] = result, _b);\n                    if (operationOptions.props) {\n                        var newResult = (_c = {},\n                            _c[name] = result,\n                            _c.ownProps = props,\n                            _c);\n                        lastResultProps = operationOptions.props(newResult, lastResultProps);\n                        childProps = lastResultProps;\n                    }\n                    return (React.createElement(WrappedComponent, __assign({}, props, childProps)));\n                }));\n            };\n            GraphQL.displayName = graphQLDisplayName;\n            GraphQL.WrappedComponent = WrappedComponent;\n            return GraphQL;\n        }(GraphQLBase));\n        return hoistNonReactStatics(GraphQL, WrappedComponent, {});\n    };\n}\n//# sourceMappingURL=subscription-hoc.js.map"]},"metadata":{},"sourceType":"module"}